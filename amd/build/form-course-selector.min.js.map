{"version":3,"file":"form-course-selector.min.js","sources":["../src/form-course-selector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course selector adaptor for auto-complete form element.\n *\n * @module     local_solsits/form-course-selector\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['core/ajax', 'jquery'], function(ajax, $) {\n\n    return {\n        // Public variables and functions.\n        processResults: function(selector, data) {\n            // Mangle the results into an array of objects.\n            var results = [];\n            var i = 0;\n            var excludelist = String($(selector).data('exclude')).split(',');\n\n            for (i = 0; i < data.length; i++) {\n                if (excludelist.indexOf(String(data[i].courseid)) === -1) {\n                    results.push({value: data[i].courseid, label: data[i].label});\n                }\n            }\n            return results;\n        },\n\n        transport: function(selector, query, success, failure) {\n            let currentcourses = document.querySelector('#id_currentcourses');\n            var promises = null;\n            if (!currentcourses) {\n                currentcourses = false;\n            } else {\n                currentcourses = currentcourses.checked;\n            }\n            if (typeof query === \"undefined\") {\n                query = '';\n            }\n\n            var searchargs = {\n                query: query,\n                currentcourses: currentcourses\n            };\n\n            var calls = [{\n                methodname: 'local_solsits_search_courses', args: searchargs\n            }];\n\n            // Go go go!\n            promises = ajax.call(calls);\n            $.when.apply($.when, promises).done(function(data) {\n                success(data);\n            }).fail(failure);\n        }\n    };\n});\n"],"names":["define","ajax","$","processResults","selector","data","results","i","excludelist","String","split","length","indexOf","courseid","push","value","label","transport","query","success","failure","currentcourses","document","querySelector","promises","checked","calls","methodname","args","call","when","apply","done","fail"],"mappings":";;;;;;;;AAuBAA,4CAAO,CAAC,YAAa,WAAW,SAASC,KAAMC,SAEpC,CAEHC,eAAgB,SAASC,SAAUC,UAE3BC,QAAU,GACVC,EAAI,EACJC,YAAcC,OAAOP,EAAEE,UAAUC,KAAK,YAAYK,MAAM,SAEvDH,EAAI,EAAGA,EAAIF,KAAKM,OAAQJ,KAC8B,IAAnDC,YAAYI,QAAQH,OAAOJ,KAAKE,GAAGM,YACnCP,QAAQQ,KAAK,CAACC,MAAOV,KAAKE,GAAGM,SAAUG,MAAOX,KAAKE,GAAGS,eAGvDV,SAGXW,UAAW,SAASb,SAAUc,MAAOC,QAASC,aACtCC,eAAiBC,SAASC,cAAc,0BACxCC,SAIAH,iBAHCA,gBAGgBA,eAAeI,aAEf,IAAVP,QACPA,MAAQ,QAQRQ,MAAQ,CAAC,CACTC,WAAY,+BAAgCC,KAN/B,CACbV,MAAOA,MACPG,eAAgBA,kBAQpBG,SAAWvB,KAAK4B,KAAKH,OACrBxB,EAAE4B,KAAKC,MAAM7B,EAAE4B,KAAMN,UAAUQ,MAAK,SAAS3B,MACzCc,QAAQd,SACT4B,KAAKb"}